<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ç»™ä½ çš„ç¥ç¦</title>
<style>
/* æ ·å¼éƒ¨åˆ†ä¿æŒä¸å˜ */
</style>
</head>
<body>
<canvas id="confetti"></canvas>
<div class="page">
  <div class="title">
    <h1>é€ä½ ä¸€ä»½å°å°çš„ç¥ç¦</h1>
    <p>ç‚¹ä¸‹é¢æŒ‰é’®ï¼Œæ”¶ä¸‹ä»Šå¤©çš„å¥½è¿å§ï½</p>
  </div>
  <button id="openBtn" class="btn">æ”¶ä¸‹ç¥ç¦ âœ¨</button>
</div>
<div id="overlay" class="overlay" aria-hidden="true">
  <div class="card" role="dialog" aria-modal="true">
    <button class="close" id="closeBtn" aria-label="å…³é—­">âœ•</button>
    <div class="card-header">
      <div class="dot"></div><div class="dot" style="background:#ffd43b"></div><div class="dot" style="background:#69db7c"></div>
      <span class="badge" id="badge">ä»Šå¤©ä¹Ÿè¦å…ƒæ°”æ»¡æ»¡</span>
    </div>
    <div class="card-body">
      <h2 class="greet-title" id="greetTitle">æ„¿ä½ æ¯å¤©éƒ½æœ‰å°ç¡®å¹¸</h2>
      <p class="greet-sub" id="greetSub">å·¥ä½œé¡ºå¿ƒï¼Œèº«ä½“å¥åº·ï¼Œä¸€åˆ‡éƒ½åˆšåˆšå¥½</p>
      <div id="typewriter" class="typewriter"></div>
      <div class="controls">
        <button class="btn" id="replay">å†è¯»ä¸€é</button>
        <button class="ghost" id="toggleMusic">éŸ³ä¹: å¼€</button>
        <button class="ghost" id="fireConfetti">æ¥ç‚¹å½©å¸¦</button>
        <button class="ghost" id="surpriseBtn">ç‚¹æˆ‘æœ‰æƒŠå–œ</button>
      </div>
    </div>
    <div class="hint">æç¤ºï¼šæ‰‹æœºç«¯å¯èƒ½éœ€è¦å…ˆç‚¹ä¸€ä¸‹æ‰èƒ½æ’­æ”¾éŸ³ä¹</div>
  </div>
</div>
<script>
// é…ç½®
const options = {
  title: "æ„¿ä½ æ¯å¤©éƒ½æœ‰å°ç¡®å¹¸",
  subtitle: "å·¥ä½œé¡ºå¿ƒï¼Œèº«ä½“å¥åº·ï¼Œä¸€åˆ‡éƒ½åˆšåˆšå¥½",
  message:
    "å—¨ï½ç»™ä½ ä¸€ç‚¹ç‚¹å°å°çš„ç¥ç¦ï¼š\n" +
    "â€¢ äº‹æƒ…é¡ºåˆ©æ¨è¿›ï¼Œå°‘åŠ ç­å¤šå¼€å¿ƒ\n" +
    "â€¢ èº«ä½“ç¨³ç¨³åœ¨çº¿ï¼ŒæŒ‰æ—¶åƒé¥­å¥½å¥½ç¡\n" +
    "â€¢ å¥½è¿å¸¸ä¼´ï¼Œé‡åˆ°çš„éƒ½æ˜¯æ¸©æŸ”çš„äººå’Œäº‹\n\n" +
    "æœ€è¿‘è¾›è‹¦å•¦ï¼Œè®°å¾—ç…§é¡¾å¥½è‡ªå·±ï¼éœ€è¦æˆ‘æ—¶ï¼Œéšå«éšåˆ° :)",
  badge: "ä»Šå¤©ä¹Ÿè¦å…ƒæ°”æ»¡æ»¡",
  theme: "#4dabf7",
  music:"https://fastly.jsdelivr.net/gh/wangyuhe789/bless-friend@main/M800002q5rys2QxxMK.mp3",
  openOnLoad: true
};

// DOM å…ƒç´ 
const overlay = document.getElementById("overlay");
const openBtn = document.getElementById("openBtn");
const closeBtn = document.getElementById("closeBtn");
const replayBtn = document.getElementById("replay");
const toggleMusicBtn = document.getElementById("toggleMusic");
const fireBtn = document.getElementById("fireConfetti");
const surpriseBtn = document.getElementById("surpriseBtn");
const typeEl = document.getElementById("typewriter");
const titleEl = document.getElementById("greetTitle");
const subEl = document.getElementById("greetSub");
const badgeEl = document.getElementById("badge");
const confettiCanvas = document.getElementById("confetti");

document.documentElement.style.setProperty("--primary", options.theme);
titleEl.textContent = options.title;
subEl.textContent = options.subtitle;
badgeEl.textContent = options.badge;

// éŸ³ä¹
let audio, musicOn = true;
function ensureAudio() {
  if (!audio) {
    audio = new Audio(options.music);
    audio.loop = true;
    audio.preload = "auto";
    audio.volume = 0.7;
  }
  return audio;
}
async function playMusic() {
  try {
    if (musicOn) await ensureAudio().play();
  } catch (e) { }
}
function pauseMusic() { if (audio) audio.pause(); }

// æ‰“å­—æ•ˆæœ
let typerAbort = 0;
async function typeText(text, el, speed = 24) {
  typerAbort++;
  const t = typerAbort;
  el.textContent = "";
  for (let i = 0; i < text.length; i++) {
    if (t !== typerAbort) return;
    el.textContent += text[i];
    await new Promise(r => setTimeout(r, text[i] === "\n" ? 200 : speed * (Math.random() * 0.4 + 0.8)));
  }
}

// å½©å¸¦æ•ˆæœ
const ctx = confettiCanvas.getContext("2d");
let confettiPieces = [];
function resizeCanvas() { confettiCanvas.width = innerWidth; confettiCanvas.height = innerHeight; }
addEventListener("resize", resizeCanvas);
resizeCanvas();
function launchConfetti(n = 180) {
  for (let i = 0; i < n; i++) {
    confettiPieces.push({
      x: confettiCanvas.width / 2, y: confettiCanvas.height / 2,
      vx: (Math.random() - 0.5) * 8, vy: (Math.random() * -8 - 4),
      size: Math.random() * 6 + 4, color: `hsl(${Math.random() * 360},90%,60%)`,
      rot: Math.random() * Math.PI, vr: (Math.random() - 0.5) * 0.4, life: 0, max: Math.random() * 90 + 60
    });
  }
}
(function loop() {
  ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
  for (let i = confettiPieces.length - 1; i >= 0; i--) {
    const p = confettiPieces[i];
    p.life++; p.vy += 0.12; p.x += p.vx; p.y += p.vy; p.rot += p.vr;
    ctx.save(); ctx.translate(p.x, p.y); ctx.rotate(p.rot); ctx.fillStyle = p.color;
    ctx.fillRect(-p.size / 2, -p.size / 2, p.size, p.size * 0.6); ctx.restore();
    if (p.life > p.max || p.y > confettiCanvas.height + 20) confettiPieces.splice(i, 1);
  }
  requestAnimationFrame(loop);
})();

// ====== éšæœºæƒŠå–œ ======
const surprises = [
  "ğŸ ä»Šå¤©ä¼šæœ‰å°ç¡®å¹¸é™ä¸´ï¼", "ğŸ’¡ ç»™è‡ªå·±ä¸€ä¸ªå°ç›®æ ‡ï½", "ğŸ€ å¥½è¿å¡å·²åˆ°è´¦ï¼Œæ¥ä¸‹æ¥é¡ºé¡ºåˆ©åˆ©ï¼",
  "ğŸŒŸ ä½ æ¯”æƒ³è±¡ä¸­æ›´æ£’ï¼Œç»§ç»­å‘å…‰ï½", "ğŸ§§ ä»Šå¤©ä¼šè¢«æ¸©æŸ”ä»¥å¾…ï½", "â˜• è®°å¾—è¡¥æ°´ä¼‘æ¯ï¼Œèƒ½é‡+1ï¼",
  "ğŸ˜„ ä¿æŒå¾®ç¬‘ï¼Œå¥½è¿ä¼šè¢«ä½ å¸å¼•ï¼", "ğŸ“’ æŠŠå¼€å¿ƒçš„å°äº‹è®°ä¸‹æ¥ï½", "ğŸŒˆ å¯¹è‡ªå·±æ¸©æŸ”ä¸€ç‚¹", "ğŸ”¥ å¹²å°±å®Œäº†ï¼Œåˆ«æƒ³å¤ªå¤šï½"
];

// ç‚¹å‡»â€œç‚¹æˆ‘æœ‰æƒŠå–œâ€ï¼šå…³é—­å°çª—å£å¹¶ç”Ÿæˆå½©å¸¦ä¸å¡ç‰‡
surpriseBtn.addEventListener("click", () => {
  closeModal();
  rainTips(24, 70); // ç¬¬ä¸€æ³¢ï¼ˆçº¦ 24 å¼ ï¼‰
  setTimeout(() => rainTips(18, 90), 1200);  // ç¬¬äºŒæ³¢
  setTimeout(() => rainTips(12, 110), 2400);  // ç¬¬ä¸‰æ³¢ â€”â€” æ€»è®¡ > 50
  launchConfetti(220);
  setTimeout(() => launchConfetti(120), 900);
  setTimeout(() => launchConfetti(120), 1800);
});

// å¼¹çª—å¼€å…³
function openModal() {
  overlay.classList.add("show");
  overlay.setAttribute("aria-hidden", "false");
  typeText(options.message, typeEl);
  playMusic();
  launchConfetti(220);
  let bursts = 0;
  const timer = setInterval(() => {
    if (!overlay.classList.contains("show") || bursts++ > 4) return clearInterval(timer);
    launchConfetti(60);
  }, 900);
}
function closeModal() {
  overlay.classList.remove("show");
  overlay.setAttribute("aria-hidden", "true");
  pauseMusic();
  typerAbort++;
}

// æ‰“å¼€å¼¹çª—
openBtn.addEventListener("click", openModal);

// ç‚¹å‡»å…³é—­æŒ‰é’®
closeBtn.addEventListener("click", closeModal);
</script>
</body>
</html>
